<!DOCTYPE html>

<html>

<head>
	<title>Roatation Api</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/>
	<script src="libs/jquery-2.0.0.min.js"></script>
	<script src="js/rotate.js"></script>
	<link rel="stylesheet" type="text/css" href="style/style.css">
</head>

<body>
	<div id="rotation_indicator_back"></div>
	<div id="rotation_indicator"></div>
	<div id="degrees" class="label"></div>
	<div id="x" class="label"></div>
	<div id="y" class="label"></div>
	<div id="z" class="label"></div>
</body>

<script type="text/javascript">

var rotationIndicator = $('#rotation_indicator');
var rotationIndicatorBack = $('#rotation_indicator_back');
var degLabel = $('#degrees');
var xLabel = $('#x');
var yLabel = $('#y');
var zLabel = $('#z');

/*
// smoothing
var lastRotX = 0;
var lastRotY = 0;
var lastRotZ = 0;
var speed = 0.25;
*/

function displayRotation(event) {
	var newRotX = (event.rotation.x*-1 + 360) % 360;
	var newRotY = (event.rotation.y*-1 + 360) % 360;
	var newRotZ = (event.rotation.z*-1 + 360) % 360;
	
	/*
	// smoothing
	newRotX = (lastRotX+360) * (1 - speed) + (newRotX+360) * speed;
	newRotY = (lastRotY+360) * (1 - speed) + (newRotY+360) * speed;
	newRotZ = (lastRotZ+360) * (1 - speed) + (newRotZ+360) * speed;
	newRotX = newRotX % 360;
	newRotY = newRotY % 360;
	newRotZ = newRotZ % 360;
	
	lastRotX = newRotX;
	lastRotY = newRotY
	lastRotZ = newRotZ;
	*/
	
	var rotXCss = 'rotatex('+ (newRotX) +'deg)';
	var rotYCss = 'rotatey('+ (newRotY) +'deg)';
	var rotZCss = 'rotatez('+ (newRotZ) +'deg)';
	
	degLabel.text('Window-Orientation: ' + event.orientation);
	xLabel.text('X: ' + Math.round(newRotX));
	yLabel.text('Y: ' + Math.round(newRotY));
	zLabel.text('Z: ' + Math.round(newRotZ));

	rotationIndicator.css('transform', rotXCss + ' ' + rotYCss + ' ' + rotZCss);
	rotationIndicatorBack.css('transform', rotXCss + ' ' + rotYCss + ' ' + rotZCss);
}

function handleVisibilityChange(event) {
	if (document['webkitHidden']) {
		window.removeEventListener('rotate', displayRotation);
	} else {
		window.addEventListener('rotate', displayRotation);
	}
}

function init() {
	document.addEventListener('webkitvisibilitychange', handleVisibilityChange, false);
	window.addEventListener('rotate', displayRotation);
}

window.onload = init;

</script>

</html>