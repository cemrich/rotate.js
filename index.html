<!DOCTYPE html>

<html>

<head>
	<title>Rotation Api</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/>
	<script src="libs/jquery-2.0.0.min.js"></script>
	<script src="js/rotate.js"></script>
	<link rel="stylesheet" type="text/css" href="style/style.css">
</head>

<body>
	<div id="rotation_indicator_back"></div>
	<div id="rotation_indicator"></div>
	<div id="degrees" class="label"></div>
	<div id="x" class="label"></div>
	<div id="y" class="label"></div>
	<div id="z" class="label"></div>
</body>

<script type="text/javascript">

var visibilityEvent = 'visibilitychange';
var hiddenProperty = 'hidden';
if (typeof(document.webkitHidden) !== 'undefined') {
	visibilityEvent = 'webkitvisibilitychange';
	hiddenProperty = 'webkitHidden';
} else if (typeof(document.mozHidden) !== 'undefined') {
	visibilityEvent = 'mozvisibilitychange';
	hiddenProperty = 'mozHidden';
}

var rotationIndicator = $('#rotation_indicator');
var rotationIndicatorBack = $('#rotation_indicator_back');
var degLabel = $('#degrees');
var xLabel = $('#x');
var yLabel = $('#y');
var zLabel = $('#z');

function displayRotation(event) {
	// invert all angles to compensate for device orientation
	var newRotX = (event.rotation.x*-1 + 360) % 360;
	var newRotY = (event.rotation.y*-1 + 360) % 360;
	var newRotZ = (event.rotation.z*-1 + 360) % 360; 
	
	var rotXCss = 'rotatex('+ (newRotX) +'deg)';
	var rotYCss = 'rotatey('+ (newRotY) +'deg)';
	var rotZCss = 'rotatez('+ (newRotZ) +'deg)';
	
	degLabel.text('Window-Orientation: ' + event.orientation);
	xLabel.text('X: ' + Math.round(event.rotation.x));
	yLabel.text('Y: ' + Math.round(event.rotation.y));
	zLabel.text('Z: ' + Math.round(event.rotation.z));

	rotationIndicator.css('transform', rotXCss + ' ' + rotYCss + ' ' + rotZCss);
	rotationIndicatorBack.css('transform', rotXCss + ' ' + rotYCss + ' ' + rotZCss);
}

/* Disable listeners for device rotation when the window
or tab is not visible to save power. */
function handleVisibilityChange(event) {
	if (document[hiddenProperty]) {
		window.removeEventListener('rotate', displayRotation);
	} else {
		window.addEventListener('rotate', displayRotation);
	}
}

function init() {
	document.addEventListener(visibilityEvent, handleVisibilityChange, false);
	window.addEventListener('rotate', displayRotation);
}

window.onload = init;

</script>

</html>